# Migration `20191022170943-fix-schema`

This migration has been generated by kiralybalint <balint.kiraly@cogito.study> at 10/22/2019, 5:09:43 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."_PermissionToUser_AB_unique"

DROP TABLE "public"."_PermissionToUser";

CREATE TABLE "public"."_UserPermissions" (
  "A" text   REFERENCES "public"."Permission"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "public"."User"("id") ON DELETE CASCADE
);

CREATE UNIQUE INDEX "_UserPermissions_AB_unique" ON "public"."_UserPermissions"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20191004163443-activation-and-reset-password-token..20191022170943-fix-schema
--- datamodel.dml
+++ datamodel.dml
@@ -180,9 +180,9 @@
   passwordToken       PasswordToken?      @relation(name: "PasswordTokenUser")
   departments         Department[]        @relation(name: "DepartmentLeader")
   institutes          Institute[]         @relation(name: "InstituteUsers")
   preferredLanguage   Language?           @relation(name: "UserPrefferedLanguage")
-  permissions         Permission[]        @relation
+  permissions         Permission[]        @relation(name: "UserPermissions")
   createdAt           DateTime            @default(now())
   updatedAt           DateTime            @updatedAt
   deletedAt           DateTime?
 }
@@ -298,9 +298,9 @@
 model Permission {
   id                           String                        @default(cuid()) @id @unique
   userGroups                   UserGroup[]                   @relation(name: "UserGroupPermissions")
-  users                        User[]                        @relation
+  users                        User[]                        @relation(name: "UserPermissions")
   departmentPermission         DepartmentPermission?         @relation
   institutePermission          InstitutePermission?          @relation
   notePermission               NotePermission?               @relation
   noteCommentPermission        NoteCommentPermission?        @relation
```

## Photon Usage

You can use a specific Photon built for this migration (20191022170943-fix-schema)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191022170943-fix-schema'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
