# Migration `20191004163443-activation-and-reset-password-token`

This migration has been generated by kiralybalint <balint.kiraly@cogito.study> at 10/4/2019, 4:34:43 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."ActivationToken" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "token" text NOT NULL DEFAULT '' ,
  "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."ResetPasswordToken" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text NOT NULL  ,
  "token" text NOT NULL DEFAULT '' ,
  "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,
  PRIMARY KEY ("email")
);

CREATE UNIQUE INDEX "ActivationToken.id" ON "public"."ActivationToken"("id")

CREATE UNIQUE INDEX "ActivationToken.token" ON "public"."ActivationToken"("token")

CREATE UNIQUE INDEX "ResetPasswordToken.email" ON "public"."ResetPasswordToken"("email")

CREATE UNIQUE INDEX "ResetPasswordToken.token" ON "public"."ResetPasswordToken"("token")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20191002185440-fix-permissions..20191004163443-activation-and-reset-password-token
--- datamodel.dml
+++ datamodel.dml
@@ -153,39 +153,54 @@
   deletedAt  DateTime?
 }
 model User {
-  id                  String          @default(cuid()) @id @unique
-  email               String          @unique
+  id                  String              @default(cuid()) @id @unique
+  email               String              @unique
   password            String
   profilePictureURL   String?
   firstName           String
   lastName            String
   phoneNumber         String?
   identifier          String
-  isActive            Boolean         @default(false)
-  role                UserRole        @relation(name: "UserRole")
-  groups              UserGroup[]     @relation(name: "UserGroups")
-  notes               Note[]          @relation(name: "NoteAuthors")
-  noteHighlights      NoteHighlight[] @relation(name: "UserNoteHighlights")
-  suggestions         Suggestion[]    @relation(name: "SuggestionAuthor")
-  approvedSuggestions Suggestion[]    @relation(name: "SuggestionApprovedBy")
-  teachedSubjects     Subject[]       @relation(name: "SubjectTeachers")
-  studiedSubjects     Subject[]       @relation(name: "SubjectStudents")
-  likedNotes          Note[]          @relation(name: "NoteLikers")
-  comments            NoteComment[]   @relation(name: "CommentAuthor")
-  likedComments       NoteComment[]   @relation(name: "CommentLikers")
-  likedSuggestions    Suggestion[]    @relation(name: "SuggestionLikers")
-  passwordToken       PasswordToken?  @relation(name: "PasswordTokenUser")
-  departments         Department[]    @relation(name: "DepartmentLeader")
-  institutes          Institute[]     @relation(name: "InstituteUsers")
-  preferredLanguage   Language?       @relation(name: "UserPrefferedLanguage")
-  permissions         Permission[]    @relation
-  createdAt           DateTime        @default(now())
-  updatedAt           DateTime        @updatedAt
+  activationToken     ActivationToken?
+  ResetPasswordToken  ResetPasswordToken?
+  isActive            Boolean             @default(false)
+  role                UserRole            @relation(name: "UserRole")
+  groups              UserGroup[]         @relation(name: "UserGroups")
+  notes               Note[]              @relation(name: "NoteAuthors")
+  noteHighlights      NoteHighlight[]     @relation(name: "UserNoteHighlights")
+  suggestions         Suggestion[]        @relation(name: "SuggestionAuthor")
+  approvedSuggestions Suggestion[]        @relation(name: "SuggestionApprovedBy")
+  teachedSubjects     Subject[]           @relation(name: "SubjectTeachers")
+  studiedSubjects     Subject[]           @relation(name: "SubjectStudents")
+  likedNotes          Note[]              @relation(name: "NoteLikers")
+  comments            NoteComment[]       @relation(name: "CommentAuthor")
+  likedComments       NoteComment[]       @relation(name: "CommentLikers")
+  likedSuggestions    Suggestion[]        @relation(name: "SuggestionLikers")
+  passwordToken       PasswordToken?      @relation(name: "PasswordTokenUser")
+  departments         Department[]        @relation(name: "DepartmentLeader")
+  institutes          Institute[]         @relation(name: "InstituteUsers")
+  preferredLanguage   Language?           @relation(name: "UserPrefferedLanguage")
+  permissions         Permission[]        @relation
+  createdAt           DateTime            @default(now())
+  updatedAt           DateTime            @updatedAt
   deletedAt           DateTime?
 }
+model ActivationToken {
+  id        String   @default(cuid()) @id @unique
+  user      User
+  token     String   @unique
+  createdAt DateTime @default(now())
+}
+
+model ResetPasswordToken {
+  email     String   @default(cuid()) @id @unique
+  token     String   @unique
+  createdAt DateTime @default(now())
+}
+
 model UserRole {
   id        String       @default(cuid()) @id @unique
   name      String
   type      UserRoleType
@@ -248,9 +263,8 @@
   deletedAt DateTime?
 }
 enum NoteCommentThreadPermissionType {
-  UPDATE_NOTE_COMMENT_THREAD
   DELETE_NOTE_COMMENT_THREAD
 }
 model NoteHighlightPermission {
```

## Photon Usage

You can use a specific Photon built for this migration (20191004163443-activation-and-reset-password-token)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191004163443-activation-and-reset-password-token'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
