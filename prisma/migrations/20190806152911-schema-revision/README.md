# Migration `20190806152911-schema-revision`

This migration has been generated by kiralybalint <balint.kiraly@cogito.study> at 8/6/2019, 3:29:11 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "public"."_NoteLikes";

DROP TABLE "public"."_CommentLikes";

DROP TABLE "public"."_SuggestionLikes";

CREATE TABLE "public"."_NoteLikers"("A" text NOT NULL  REFERENCES "public"."Note"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_CommentLikers"("A" text NOT NULL  REFERENCES "public"."NoteComment"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_SuggestionLikers"("A" text NOT NULL  REFERENCES "public"."Suggestion"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

ALTER TABLE "public"."NoteComment" DROP COLUMN "position";

ALTER TABLE "public"."NoteCommentThread" ADD COLUMN "position" text NOT NULL DEFAULT '' ;

ALTER TABLE "public"."User" DROP COLUMN "phoneNumber",ADD COLUMN "phoneNumber" text   ;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190806132643-fix-relations..20190806152911-schema-revision
--- datamodel.dml
+++ datamodel.dml
@@ -54,9 +54,9 @@
   noteCategory   NoteCategory
   suggestions    Suggestion[]        @relation(name: "NoteSuggestions")
   commentThreads NoteCommentThread[] @relation(name: "NoteCommentThreads")
   authors        User[]              @relation(name: "NoteAuthors")
-  likes          User[]              @relation(name: "NoteLikes")
+  likers         User[]              @relation(name: "NoteLikers")
   highlights     NoteHighlight[]     @relation(name: "NoteHighlights")
   subject        Subject             @relation(name: "SubjectNotes")
   createdAt      DateTime            @default(now())
   updatedAt      DateTime            @updatedAt
@@ -65,11 +65,10 @@
 model NoteComment {
   id          String             @default(cuid()) @id @unique
   content     String
-  position    String
   author      User               @relation(name: "CommentAuthor")
-  likes       User[]             @relation(name: "CommentLikes")
+  likers      User[]             @relation(name: "CommentLikers")
   thread      NoteCommentThread? @relation(name: "NoteCommentThreadComment")
   threadReply NoteCommentThread? @relation(name: "NoteCommentThreadReplies")
   createdAt   DateTime           @default(now())
   updatedAt   DateTime           @updatedAt
@@ -77,8 +76,9 @@
 }
 model NoteCommentThread {
   id        String        @default(cuid()) @id @unique
+  position  String
   comment   NoteComment   @relation(name: "NoteCommentThreadComment")
   replies   NoteComment[] @relation(name: "NoteCommentThreadReplies")
   note      Note          @relation(name: "NoteCommentThreads")
   createdAt DateTime      @default(now())
@@ -134,9 +134,9 @@
 model Suggestion {
   id         String    @default(cuid()) @id @unique
   delta      String
   approvedAt DateTime?
-  likes      User[]    @relation(name: "SuggestionLikes")
+  likers     User[]    @relation(name: "SuggestionLikers")
   approvedBy User?     @relation(name: "SuggestionApprovedBy")
   note       Note      @relation(name: "NoteSuggestions")
   author     User      @relation(name: "SuggestionAuthor")
   createdAt  DateTime  @default(now())
@@ -150,21 +150,21 @@
   password            String
   profilePictureURL   String?
   firstName           String
   lastName            String
-  phoneNumber         String
+  phoneNumber         String?
   identifier          String
   role                UserRole        @relation(name: "UserRole")
   notes               Note[]          @relation(name: "NoteAuthors")
   noteHighlights      NoteHighlight[] @relation(name: "UserNoteHighlights")
   suggestions         Suggestion[]    @relation(name: "SuggestionAuthor")
   approvedSuggestions Suggestion[]    @relation(name: "SuggestionApprovedBy")
   teachedSubjects     Subject[]       @relation(name: "SubjectTeachers")
   studiedSubjects     Subject[]       @relation(name: "SubjectStudents")
-  noteLikes           Note[]          @relation(name: "NoteLikes")
+  likedNotes          Note[]          @relation(name: "NoteLikers")
   comments            NoteComment[]   @relation(name: "CommentAuthor")
-  commentLikes        NoteComment[]   @relation(name: "CommentLikes")
-  suggestionLikes     Suggestion[]    @relation(name: "SuggestionLikes")
+  likedComments       NoteComment[]   @relation(name: "CommentLikers")
+  likedSuggestions    Suggestion[]    @relation(name: "SuggestionLikers")
   passwordToken       PasswordToken   @relation(name: "PasswordTokenUser")
   departments         Department[]    @relation(name: "DepartmentLeader")
   institutes          Institute[]     @relation(name: "InstituteUsers")
   createdAt           DateTime        @default(now())
```

## Photon Usage

You can use a specific Photon built for this migration (20190806152911-schema-revision)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190806152911-schema-revision'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
