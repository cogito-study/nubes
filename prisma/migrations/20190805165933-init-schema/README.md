# Migration `20190805165933-init-schema`

This migration has been generated by kiralybalint <balint.kiraly@cogito.study> at 8/5/2019, 4:59:33 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Department"("id" text NOT NULL  ,"name" text NOT NULL DEFAULT '' ,"description" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."Institute"("id" text NOT NULL  ,"name" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."Note"("id" text NOT NULL  ,"content" text NOT NULL DEFAULT '' ,"contentHTML" text NOT NULL DEFAULT '' ,"title" text NOT NULL DEFAULT '' ,"number" integer NOT NULL DEFAULT 0 ,"description" text   ,"noteCategory" text NOT NULL DEFAULT 'NOTE' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."NoteComment"("id" text NOT NULL  ,"content" text NOT NULL DEFAULT '' ,"position" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."NoteCommentThread"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."NoteHighlight"("id" text NOT NULL  ,"position" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."PasswordToken"("id" text NOT NULL  ,"token" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."Subject"("id" text NOT NULL  ,"code" text NOT NULL DEFAULT '' ,"name" text NOT NULL DEFAULT '' ,"description" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."SubjectInformation"("id" text NOT NULL  ,"title" text NOT NULL DEFAULT '' ,"subtitle" text   ,"content" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."Suggestion"("id" text NOT NULL  ,"delta" text NOT NULL DEFAULT '' ,"approvedAt" timestamp(3)   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."TopNoteHighlight"("id" text NOT NULL  ,"position" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."User"("id" text NOT NULL  ,"email" text NOT NULL DEFAULT '' ,"password" text NOT NULL DEFAULT '' ,"profilePictureURL" text   ,"firstName" text NOT NULL DEFAULT '' ,"lastName" text NOT NULL DEFAULT '' ,"phoneNumber" text NOT NULL DEFAULT '' ,"identifier" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."UserRole"("id" text NOT NULL  ,"name" text NOT NULL DEFAULT '' ,"type" text NOT NULL DEFAULT 'USER' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"deletedAt" timestamp(3)   ,PRIMARY KEY ("id"));

CREATE TABLE "public"."_InstituteUsers"("A" text NOT NULL  REFERENCES "public"."Institute"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_NoteAuthors"("A" text NOT NULL  REFERENCES "public"."Note"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_NoteLikes"("A" text NOT NULL  REFERENCES "public"."Note"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_SubjectNotes"("A" text NOT NULL  REFERENCES "public"."Note"("id"),"B" text NOT NULL  REFERENCES "public"."Subject"("id"));

CREATE TABLE "public"."_CommentLikes"("A" text NOT NULL  REFERENCES "public"."NoteComment"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_SubjectTeachers"("A" text NOT NULL  REFERENCES "public"."Subject"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

CREATE TABLE "public"."_SubjectStudents"("A" text NOT NULL  REFERENCES "public"."Subject"("id"),"B" text NOT NULL  REFERENCES "public"."User"("id"));

ALTER TABLE "public"."Department" ADD COLUMN "leader" text NOT NULL  REFERENCES "public"."User"("id"),ADD COLUMN "institute" text NOT NULL  REFERENCES "public"."Institute"("id");

ALTER TABLE "public"."Note" ADD COLUMN "suggestions" text NOT NULL  REFERENCES "public"."Suggestion"("id");

ALTER TABLE "public"."NoteComment" ADD COLUMN "author" text NOT NULL  REFERENCES "public"."User"("id"),ADD COLUMN "thread" text NOT NULL  REFERENCES "public"."NoteCommentThread"("id"),ADD COLUMN "threadReply" text   REFERENCES "public"."NoteCommentThread"("id");

ALTER TABLE "public"."NoteCommentThread" ADD COLUMN "note" text NOT NULL  REFERENCES "public"."Note"("id");

ALTER TABLE "public"."NoteHighlight" ADD COLUMN "note" text NOT NULL  REFERENCES "public"."Note"("id"),ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id");

ALTER TABLE "public"."PasswordToken" ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id");

ALTER TABLE "public"."Subject" ADD COLUMN "department" text NOT NULL  REFERENCES "public"."Department"("id");

ALTER TABLE "public"."SubjectInformation" ADD COLUMN "subject" text NOT NULL  REFERENCES "public"."Subject"("id");

ALTER TABLE "public"."Suggestion" ADD COLUMN "approvedBy" text   REFERENCES "public"."User"("id"),ADD COLUMN "author" text NOT NULL  REFERENCES "public"."User"("id");

ALTER TABLE "public"."TopNoteHighlight" ADD COLUMN "note" text NOT NULL  REFERENCES "public"."Note"("id");

ALTER TABLE "public"."User" ADD COLUMN "role" text NOT NULL  REFERENCES "public"."UserRole"("id");

CREATE UNIQUE INDEX "Department.id._UNIQUE" ON "public"."Department"("id")

CREATE UNIQUE INDEX "Institute.id._UNIQUE" ON "public"."Institute"("id")

CREATE UNIQUE INDEX "Note.id._UNIQUE" ON "public"."Note"("id")

CREATE UNIQUE INDEX "NoteComment.id._UNIQUE" ON "public"."NoteComment"("id")

CREATE UNIQUE INDEX "NoteCommentThread.id._UNIQUE" ON "public"."NoteCommentThread"("id")

CREATE UNIQUE INDEX "NoteHighlight.id._UNIQUE" ON "public"."NoteHighlight"("id")

CREATE UNIQUE INDEX "PasswordToken.id._UNIQUE" ON "public"."PasswordToken"("id")

CREATE UNIQUE INDEX "PasswordToken.token._UNIQUE" ON "public"."PasswordToken"("token")

CREATE UNIQUE INDEX "Subject.id._UNIQUE" ON "public"."Subject"("id")

CREATE UNIQUE INDEX "Subject.code._UNIQUE" ON "public"."Subject"("code")

CREATE UNIQUE INDEX "SubjectInformation.id._UNIQUE" ON "public"."SubjectInformation"("id")

CREATE UNIQUE INDEX "Suggestion.id._UNIQUE" ON "public"."Suggestion"("id")

CREATE UNIQUE INDEX "TopNoteHighlight.id._UNIQUE" ON "public"."TopNoteHighlight"("id")

CREATE UNIQUE INDEX "UserRole.id._UNIQUE" ON "public"."UserRole"("id")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190801135018-init..20190805165933-init-schema
--- datamodel.dml
+++ datamodel.dml
@@ -10,21 +10,182 @@
 generator nexus_prisma {
   provider = "nexus-prisma"
 }
-model Post {
-  id        String   @default(cuid()) @id @unique
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-  published Boolean
+enum NoteCategory {
+  NOTE
+  CASE_STUDY
+}
+
+enum UserRoleType {
+  USER
+  ADMIN
+  PROFESSOR
+}
+
+model Department {
+  id          String    @default(cuid()) @id @unique
+  name        String
+  description String
+  leader      User      @relation(name: "DepartmentLeader")
+  subjects    Subject[] @relation(name: "DepartmentSubjects")
+  institute   Institute @relation(name: "DepartmentInstitute")
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  deletedAt   DateTime?
+}
+
+model Institute {
+  id          String       @default(cuid()) @id @unique
+  name        String
+  departments Department[] @relation(name: "DepartmentInstitute")
+  users       User[]       @relation(name: "InstituteUsers")
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @updatedAt
+  deletedAt   DateTime?
+}
+
+model Note {
+  id             String              @default(cuid()) @id @unique
+  content        String
+  contentHTML    String
+  title          String
+  number         Int
+  description    String?
+  noteCategory   NoteCategory
+  suggestions    Suggestion          @relation(name: "NoteSuggestions")
+  commentThreads NoteCommentThread[] @relation(name: "NoteCommentThreads")
+  authors        User[]              @relation(name: "NoteAuthors")
+  likes          User[]              @relation(name: "NoteLikes")
+  highlights     NoteHighlight[]     @relation(name: "NoteHighlights")
+  topHighlights  TopNoteHighlight[]  @relation(name: "NoteTopHighlights")
+  subject        Subject[]           @relation(name: "SubjectNotes")
+  createdAt      DateTime            @default(now())
+  updatedAt      DateTime            @updatedAt
+  deletedAt      DateTime?
+}
+
+model NoteComment {
+  id          String             @default(cuid()) @id @unique
+  content     String
+  position    String
+  author      User               @relation(name: "CommentAuthor")
+  likes       User[]             @relation(name: "CommentLikes")
+  thread      NoteCommentThread? @relation(name: "NoteCommentThreadComment")
+  threadReply NoteCommentThread? @relation(name: "NoteCommentThreadReplies")
+  createdAt   DateTime           @default(now())
+  updatedAt   DateTime           @updatedAt
+  deletedAt   DateTime?
+}
+
+model NoteCommentThread {
+  id        String        @default(cuid()) @id @unique
+  comment   NoteComment   @relation(name: "NoteCommentThreadComment")
+  replies   NoteComment[] @relation(name: "NoteCommentThreadReplies")
+  note      Note          @relation(name: "NoteCommentThreads")
+  createdAt DateTime      @default(now())
+  updatedAt DateTime      @updatedAt
+  deletedAt DateTime?
+}
+
+model NoteHighlight {
+  id        String    @default(cuid()) @id @unique
+  position  String
+  user      User      @relation(name: "UserNoteHighlights")
+  note      Note      @relation(name: "NoteHighlights")
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  deletedAt DateTime?
+}
+
+model PasswordToken {
+  id        String    @default(cuid()) @id @unique
+  token     String    @unique
+  user      User      @relation(name: "PasswordTokenUser")
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  deletedAt DateTime?
+}
+
+model Subject {
+  id           String               @default(cuid()) @id @unique
+  code         String               @unique
+  name         String
+  description  String
+  department   Department           @relation(name: "DepartmentSubjects")
+  teachers     User[]               @relation(name: "SubjectTeachers")
+  students     User[]               @relation(name: "SubjectStudents")
+  informations SubjectInformation[] @relation(name: "SubjectInformations")
+  notes        Note[]               @relation(name: "SubjectNotes")
+  createdAt    DateTime             @default(now())
+  updatedAt    DateTime             @updatedAt
+  deletedAt    DateTime?
+}
+
+model SubjectInformation {
+  id        String    @default(cuid()) @id @unique
   title     String
-  content   String?
-  author    User?
+  subtitle  String?
+  content   String
+  subject   Subject   @relation(name: "SubjectInformations")
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  deletedAt DateTime?
 }
+model Suggestion {
+  id         String    @default(cuid()) @id @unique
+  delta      String
+  approvedAt DateTime?
+  approvedBy User?     @relation(name: "SuggestionApprovedBy")
+  note       Note      @relation(name: "NoteSuggestions")
+  author     User      @relation(name: "SuggestionAuthor")
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  deletedAt  DateTime?
+}
+
+model TopNoteHighlight {
+  id        String    @default(cuid()) @id @unique
+  position  String
+  note      Note      @relation(name: "NoteTopHighlights")
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  deletedAt DateTime?
+}
+
 model User {
-  id       String  @default(cuid()) @id @unique
-  email    String  @unique
-  password String
-  name     String?
-  posts    Post[]
+  id                  String          @default(cuid()) @id @unique
+  email               String          @unique
+  password            String
+  profilePictureURL   String?
+  firstName           String
+  lastName            String
+  phoneNumber         String
+  identifier          String
+  role                UserRole        @relation(name: "UserRole")
+  notes               Note[]          @relation(name: "NoteAuthors")
+  noteHighlights      NoteHighlight[] @relation(name: "UserNoteHighlights")
+  suggestions         Suggestion[]    @relation(name: "SuggestionAuthor")
+  approvedSuggestions Suggestion[]    @relation(name: "SuggestionApprovedBy")
+  teach               Subject[]       @relation(name: "SubjectTeachers")
+  study               Subject[]       @relation(name: "SubjectStudents")
+  noteLikes           Note[]          @relation(name: "NoteLikes")
+  comments            NoteComment[]   @relation(name: "CommentAuthor")
+  commentLikes        NoteComment[]   @relation(name: "CommentLikes")
+  passwordToken       PasswordToken   @relation(name: "PasswordTokenUser")
+  departments         Department[]    @relation(name: "DepartmentLeader")
+  institute           Institute[]     @relation(name: "InstituteUsers")
+  createdAt           DateTime        @default(now())
+  updatedAt           DateTime        @updatedAt
+  deletedAt           DateTime?
 }
+
+model UserRole {
+  id        String       @default(cuid()) @id @unique
+  name      String
+  type      UserRoleType
+  users     User[]       @relation(name: "UserRole")
+  createdAt DateTime     @default(now())
+  updatedAt DateTime     @updatedAt
+  deletedAt DateTime?
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20190805165933-init-schema)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190805165933-init-schema'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
