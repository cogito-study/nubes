# Migration `20191205193805-auth-refactor`

This migration has been generated by Mate Papp <mate.papp@cogito.study> at 12/5/2019, 7:38:05 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."User" DROP COLUMN "identifier",
ADD COLUMN "identifier" text   ,
DROP COLUMN "role",
ADD COLUMN "role" text   REFERENCES "public"."UserRole"("id") ON DELETE SET NULL;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20191205143106-re-re-init..20191205193805-auth-refactor
--- datamodel.dml
+++ datamodel.dml
@@ -1,6 +1,6 @@
 datasource postgres {
-  url = "***"
+  url      = env("POSTGRESQL_URL")
   provider = "postgres"
 }
 generator photon {
@@ -191,14 +191,14 @@
   profilePictureURL   String?
   firstName           String
   lastName            String
   phoneNumber         String?
-  identifier          String
+  identifier          String?
   position            String?
   activationToken     ActivationToken?
   ResetPasswordToken  ResetPasswordToken?
   isActive            Boolean             @default(false)
-  role                UserRole            @relation(name: "UserRole")
+  role                UserRole?           @relation(name: "UserRole")
   notes               Note[]              @relation(name: "NoteAuthors")
   noteHighlights      NoteHighlight[]     @relation(name: "UserNoteHighlights")
   suggestions         Suggestion[]        @relation(name: "SuggestionAuthor")
   approvedSuggestions Suggestion[]        @relation(name: "SuggestionApprovedBy")
```

## Photon Usage

You can use a specific Photon built for this migration (20191205193805-auth-refactor)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191205193805-auth-refactor'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
